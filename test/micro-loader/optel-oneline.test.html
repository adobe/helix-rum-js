<html>

<head>
  <script>
    // this is set-up for the test
    window.RUM_PARAMS = { program: 'pXXXXXX', environment: 'eYYYYYY' };
    window.sendBeaconArgs = {
      url: 'never has been set',
      data: {},
    };
    // eslint-disable-next-line no-underscore-dangle
    navigator._sendBeacon = navigator.sendBeacon;
    navigator.sendBeacon = (url, data) => {
      const json = JSON.parse(data);
      if (json.checkpoint === 'top') {
        sendBeaconArgs.url = url;
        sendBeaconArgs.data = json;
      }
      return true;
    };
  </script>
  <script defer data-script="standalone.js">
    var c = document.currentScript,
      d = c.dataset,
      q = new URLSearchParams(location.search),
      v = q.get('rum') || q.get('optel') || d.rate,
      w = { on: 1, off: 0, high: 10, low: 1e3 }[v] || 100,
      r = (window.hlx = window.hlx || {}).rum ||
        (window.hlx.rum = { id: crypto.randomUUID().slice(-4) });
    if (r.isSelected || (w && Math.random() * w < 1)) {
      var n = document.createElement('script');
      for (var a of c.attributes) n.setAttribute(a.name, a.value);
      n.src = d.script; document.head.append(n);
    }
  </script>
</head>

<body>
  <script type="module">
    import { runTests } from '@web/test-runner-mocha';
    import { expect } from '@esm-bundle/chai';
    /* eslint-env mocha */
    runTests(async () => {
      describe('Operational Telemetry - Micro-Loader', () => {
        it('when not-selected, no data is sent', async () => {
          // no test condition, as this is intentionally random. See
          // optel-in.test.html and optel-out.test.html for repeatable tests
        });
      });
    });
  </script>
</body>

</html>